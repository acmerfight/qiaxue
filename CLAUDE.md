# 项目说明

**这是一个微信小程序项目**
- 使用 TypeScript 开发
- 使用微信开发者工具进行编译和调试
- 遵循微信小程序开发规范

# 🚨 必须遵守的核心规范

## 1. 状态管理 - 使用 ccstate
- **所有状态使用 ccstate 管理** - 业务数据、用户状态、页面状态统一通过 ccstate 处理
- **页面只负责渲染和交互** - 页面文件仅处理 UI 展示和用户操作，不维护业务状态
- **状态变更通过专门函数** - 创建独立的状态管理函数，页面调用这些函数修改状态

## 2. 开发流程 - TDD 模式
- **先写测试再写代码** - 新功能必须先编写测试用例，然后实现功能
- **测试真实状态变化** - 测试重点关注状态管理逻辑和集成功能，不测试 UI 渲染
- **避免使用 mock** - 尽量测试真实的状态流转和数据处理，减少 mock 依赖
- **测试文件位置** - 在对应功能目录下创建 `*.test.ts` 文件

## 3. TypeScript 类型检查
### 编码要求
- **禁用 any 类型** - 除极特殊情况外，不使用 any，用 unknown 替代
- **定义完整接口** - 所有数据结构、API 响应、状态对象都要有明确 interface
- **函数类型注解** - 所有函数参数和返回值必须声明类型

### 提交前必须执行
**每次代码修改后必须运行 TypeScript 类型检查并确保通过**
```bash
npx tsc --noEmit
```
- 该命令必须无错误输出
- 如果有类型错误，必须修复后才能提交代码

## 4. Git 提交规范
### 自动提交要求
每次修改文件后必须自动进行 commit。

### 提交信息格式
```
<type>(<scope>): <subject>

<body>
```

**Type 类型**：
- `feat`: 新功能
- `fix`: 修复bug
- `docs`: 文档修改
- `style`: 代码格式修改（不影响代码运行）
- `refactor`: 重构代码
- `test`: 测试用例修改
- `chore`: 构建过程或辅助工具的变动

**Scope 范围**（可选）：
- `pages`: 页面相关
- `components`: 组件相关
- `utils`: 工具函数
- `config`: 配置文件
- `api`: 接口相关

# 📋 编码细节规范

## 错误处理规范
- **严格遵循 Fail-Fast 机制** - 遇到不能处理的错误必须立即抛出，绝对不能静默处理
- **禁止空 catch 块** - 不允许 `catch(e) {}` 这种什么都不做的异常处理
- **明确错误边界** - 错误应该在合适的层级被处理，不能在底层吞掉所有异常
- **记录关键错误** - 重要的错误信息必须记录，便于调试和追踪

## 函数设计规范
- **尽量少使用默认参数** - 默认参数会让代码难以理解，优先使用明确的参数传递
- **函数职责单一** - 每个函数只做一件事，避免参数过多和逻辑复杂
- **参数语义明确** - 参数名称要能清楚表达含义，避免使用 flag、data 等模糊名称

## 数据安全规范
- **禁止硬编码敏感信息** - API密钥、用户凭证、服务器地址等必须通过环境变量或配置文件管理
- **用户数据脱敏** - 日志中不能包含用户隐私信息（手机号、密码、身份证等）
- **接口权限验证** - 所有接口调用必须有合适的权限检查，验证用户身份
- **数据传输加密** - 敏感数据传输必须使用 HTTPS，重要数据考虑额外加密

## 生命周期管理
- **清理定时器** - 页面 onUnload 时必须清理所有 setTimeout/setInterval
- **取消请求** - 页面销毁时取消未完成的网络请求，避免回调执行报错
- **事件解绑** - 组件销毁时解绑全局事件监听，防止内存泄漏
- **资源释放** - 及时释放大对象引用、关闭 WebSocket 连接等

# 💡 微信小程序特殊说明

## TypeScript 配置 - 无需关注的问题
- **无需安装 typescript 包** - 微信开发者工具内置 TypeScript 编译器
- **无需 outDir/rootDir** - 微信开发者工具自动处理编译输出
- **无需复杂的模块解析配置** - 小程序有自己的模块系统
- **当前 tsconfig.json 已足够严格** - 已启用 strict 模式和各种检查

## 已配置完善的部分
- project.config.json 已启用 typescript 插件
- typings 目录提供完整的微信 API 类型定义
- miniprogram-api-typings 提供官方类型支持

# ⚡ 快速检查清单

编码前：
- [ ] 是否需要先写测试？（TDD）
- [ ] 状态管理是否使用 ccstate？

编码中：
- [ ] 是否避免使用 any 类型？
- [ ] 函数是否有完整的类型注解？
- [ ] 错误是否正确处理（无空 catch）？
- [ ] 是否有硬编码的敏感信息？

提交前：
- [ ] 运行 `npx tsc --noEmit` 无错误？
- [ ] Git 提交信息格式正确？
- [ ] 生命周期是否正确管理？