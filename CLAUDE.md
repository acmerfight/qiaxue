# 微信小程序项目开发规范

**技术栈**: TypeScript + 微信开发者工具 + 自定义状态管理

## 🧠 UltraThink 执行模式 (最高优先级)

每次工作必须遵守的思考框架：
- 深度分析问题本质和根本原因
- 预判潜在风险和边界情况  
- 站在用户角度思考体验
- 寻找最优解而非快速解

---

## ⚡ 立即执行规则 (每次任务开始前检查)

### 📝 提交规则 - 每完成一个文件修改立即执行
```bash
# 1. 添加修改
git add .

# 2. 规范提交格式: <type>(<scope>): <subject>
git commit -m "feat(pages): 添加用户登录功能"

# 3. 立即推送 
git push origin main
```

### 🔍 质量检查 - 提交前必须全部通过
```bash
npm test              # 测试必须 100% 通过
npx tsc --noEmit      # 类型检查必须无错误
```

### 💻 TypeScript 强制要求
- ❌ 禁用 `any` → 用 `unknown` 替代
- ✅ 所有函数必须有 `: void` 或具体返回类型
- ✅ 所有参数必须声明类型
- ✅ 所有接口用 `interface` 定义

### 🏗️ 状态管理铁律
- ✅ 所有状态使用自定义状态管理
- ❌ 禁止页面维护业务状态
- ✅ 页面只负责渲染和用户交互

### 🔒 安全底线
- ❌ 禁止硬编码密钥/凭证
- ❌ 禁止空 `catch` 块
- ✅ `onUnload` 必须清理资源

## 🧪 测试策略: "测试用户能否成功，而非代码是否正确"

### 测试分层 (5-15-80原则)
```
80% 用户行为测试 ← 重点投入
15% 集成测试
5%  工具函数测试
```

### 测试价值判断 (写测试前必问)
1. 测试失败时，用户会遇到问题吗？
2. 产品经理看得懂这个测试吗？  
3. 没有这个测试，敢发布吗？

### Mock使用红线
- **0-1个Mock** ✅ 高价值测试
- **2-3个Mock** ⚠️ 谨慎评估
- **4+个Mock** ❌ 立即删除

**禁止Mock:** 自己的业务代码、页面生命周期、状态管理、用户交互

---

## 📋 编码规范速查

### 错误处理
- Fail-Fast: 不能处理的错误立即抛出
- 禁止静默处理: 错误必须记录或抛出

### 函数设计  
- 职责单一、参数明确、少用默认参数

### 生命周期管理
- `onUnload` 必须清理: 定时器、事件监听、网络请求

---

## ⚡ 工作流检查清单

### 开始编码前
- [ ] 描述完整用户场景？
- [ ] 确认使用自定义状态管理？
- [ ] 检查已有类似测试？

### 编码过程中
- [ ] 函数有类型注解 `: void` ？  
- [ ] 避免 `any`，用 `unknown`？
- [ ] 错误正确处理？
- [ ] **修改文件后立即commit？**

### 提交前验证
```bash
npm test              # 必须100%通过
npx tsc --noEmit      # 必须无类型错误
git add . && git commit -m "feat(scope): 描述" && git push
```

---

## 📚 快速参考

### Git提交格式
```
<type>(<scope>): <subject>
```
**类型**: feat/fix/docs/style/refactor/test/chore  
**范围**: pages/components/utils/config/api

### 测试命令
```bash
npm test                # 运行测试
npm run test:watch      # 监听模式  
npm run test:coverage   # 覆盖率报告
```